<div class="analysis-container">
  <!-- Header -->
  <div class="analysis-header">
    <div class="header-content">
      <div class="title-section">
        <h1 class="page-title">
          <i class="bi bi-bar-chart-line"></i>
          ุงูุชุญูููุงุช ูุงูุฅุญุตุงุฆูุงุช
        </h1>
        <p class="page-subtitle">ุชุญููู ุดุงูู ูุจูุงูุงุช ุงููุธุงู ูุงูุฃุฏุงุก</p>
      </div>

      <!-- Period Filter -->
      <div class="period-filter">
        <div class="filter-tabs">
          <button
            class="filter-tab"
            [class.active]="selectedPeriod === 'week'"
            (click)="selectPeriod('week')">
            ูุฐุง ุงูุฃุณุจูุน
          </button>
          <button
            class="filter-tab"
            [class.active]="selectedPeriod === 'month'"
            (click)="selectPeriod('month')">
            ูุฐุง ุงูุดูุฑ
          </button>
          <button
            class="filter-tab"
            [class.active]="selectedPeriod === 'quarter'"
            (click)="selectPeriod('quarter')">
            ูุฐุง ุงูุฑุจุน
          </button>
          <button
            class="filter-tab"
            [class.active]="selectedPeriod === 'year'"
            (click)="selectPeriod('year')">
            ูุฐุง ุงูุนุงู
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading">
    <div class="loading-spinner">
      <i class="bi bi-arrow-repeat spin-animation"></i>
      <p>{{ loadingMessage }}</p>
    </div>
  </div>

  <!-- Error State -->
  <div class="error-container" *ngIf="hasError && !isLoading">
    <div class="error-card">
      <i class="bi bi-exclamation-triangle"></i>
      <h3>ุญุฏุซ ุฎุทุฃ</h3>
      <p>{{ errorMessage }}</p>
      <button class="retry-btn" (click)="refreshData()">
        <i class="bi bi-arrow-clockwise"></i>
        ุฅุนุงุฏุฉ ุงููุญุงููุฉ
      </button>
    </div>
  </div>

  <!-- Main Content -->
  <div class="analysis-content" *ngIf="!isLoading && !hasError">

    <!-- Statistics Cards Grid -->
    <div class="stats-grid">
      <div class="stat-card" *ngFor="let card of statCards" [style.border-right-color]="card.color">
        <div class="stat-icon" [style.background-color]="card.color + '15'">
          <i class="bi {{ card.icon }}" [style.color]="card.color"></i>
        </div>
        <div class="stat-info">
          <h3 class="stat-value">{{ formatNumber(+card.value) }}</h3>
          <p class="stat-title">{{ card.title }}</p>
          <span class="stat-subtitle">{{ card.subtitle }}</span>
        </div>
      </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="tabs-container">
      <div class="tabs-nav">
        <button
          class="tab-btn"
          [class.active]="activeTab === 'overview'"
          (click)="switchTab('overview')">
          <i class="bi bi-grid"></i>
          <span>ูุธุฑุฉ ุนุงูุฉ</span>
        </button>
        <button
          class="tab-btn"
          [class.active]="activeTab === 'cutting'"
          (click)="switchTab('cutting')">
          <i class="bi bi-scissors"></i>
          <span>ูุธุงู ุงููุต</span>
        </button>
        <button
          class="tab-btn"
          [class.active]="activeTab === 'procurement'"
          (click)="switchTab('procurement')">
          <i class="bi bi-cart"></i>
          <span>ุงููุดุชุฑูุงุช</span>
        </button>
        <button
          class="tab-btn"
          [class.active]="activeTab === 'secretariat'"
          (click)="switchTab('secretariat')">
          <i class="bi bi-people"></i>
          <span>ุงูุณูุฑุชุงุฑูุง</span>
        </button>
        <button
          class="tab-btn"
          [class.active]="activeTab === 'suppliers'"
          (click)="switchTab('suppliers')">
          <i class="bi bi-truck"></i>
          <span>ุงูููุฑุฏูู</span>
        </button>
      </div>
    </div>

    <!-- Overview Tab -->
    <div class="tab-content" *ngIf="activeTab === 'overview'">
      <div class="overview-grid">
        <div class="category-card" *ngFor="let category of categories">
          <div class="category-header">
            <div class="category-icon" [style.background-color]="category.color + '15'">
              <i class="bi {{ category.icon }}" [style.color]="category.color"></i>
            </div>
            <h3 class="category-name">{{ category.name }}</h3>
          </div>

          <div class="category-stats">
            <div class="stat-item" *ngFor="let stat of category.stats">
              <span class="stat-label">{{ stat.label }}</span>
              <span class="stat-value">{{ stat.value }}</span>
            </div>
          </div>

          <div class="category-chart" *ngIf="category.chartData">
            <div class="chart-bars">
              <div
                class="chart-bar"
                *ngFor="let value of category.chartData.data; let i = index"
                [style.width.%]="getChartPercentage(category.chartData.data, i)"
                [style.background-color]="category.chartData.colors[i]">
                <span class="bar-value">{{ value }}</span>
              </div>
            </div>
            <div class="chart-labels">
              <span class="chart-label" *ngFor="let label of category.chartData.labels; let i = index">
                <span class="label-dot" [style.background-color]="category.chartData.colors[i]"></span>
                {{ label }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Cutting Tab -->
    <div class="tab-content" *ngIf="activeTab === 'cutting'">
      <div class="charts-row">
        <!-- Status Distribution Chart -->
        <div class="chart-card">
          <div class="chart-header">
            <h3 class="chart-title">
              <i class="bi bi-pie-chart-fill"></i>
              ุชูุฒูุน ุฃูุงูุฑ ุงููุต ุญุณุจ ุงูุญุงูุฉ
            </h3>
          </div>
          <div class="chart-body">
            <canvas id="cuttingStatusChart"></canvas>
          </div>
        </div>

        <!-- Material Distribution Chart -->
        <div class="chart-card">
          <div class="chart-header">
            <h3 class="chart-title">
              <i class="bi bi-bar-chart-fill"></i>
              ุชูุฒูุน ุฃูุงูุฑ ุงููุต ุญุณุจ ููุน ุงููุงุฏุฉ
            </h3>
          </div>
          <div class="chart-body">
            <canvas id="cuttingMaterialChart"></canvas>
          </div>
        </div>
      </div>

      <!-- Overall Progress -->
      <div class="progress-card" *ngIf="cuttingStats?.totalProgress">
        <div class="progress-header">
          <h3 class="progress-title">
            <i class="bi bi-activity"></i>
            ุงูุชูุฏู ุงูุฅุฌูุงูู ูููุต
          </h3>
        </div>
        <div class="progress-body">
          <div class="progress-stats-grid">
            <div class="progress-stat-item">
              <div class="stat-icon-wrapper" style="background: rgba(59, 130, 246, 0.1);">
                <i class="bi bi-layers-fill" style="color: #3b82f6;"></i>
              </div>
              <div class="stat-content">
                <span class="stat-label">ุงููููุฉ ุงูุฅุฌูุงููุฉ</span>
                <span class="stat-value">{{ formatNumber(cuttingStats.totalProgress.totalQuantity) }}</span>
              </div>
            </div>
            <div class="progress-stat-item">
              <div class="stat-icon-wrapper" style="background: rgba(16, 185, 129, 0.1);">
                <i class="bi bi-check-circle-fill" style="color: #10b981;"></i>
              </div>
              <div class="stat-content">
                <span class="stat-label">ุชู ูุตู</span>
                <span class="stat-value">{{ formatNumber(cuttingStats.totalProgress.totalCut) }}</span>
              </div>
            </div>
            <div class="progress-stat-item">
              <div class="stat-icon-wrapper" style="background: rgba(139, 92, 246, 0.1);">
                <i class="bi bi-percent" style="color: #8b5cf6;"></i>
              </div>
              <div class="stat-content">
                <span class="stat-label">ูุณุจุฉ ุงูุฅูุฌุงุฒ</span>
                <span class="stat-value">{{ cuttingStats.totalProgress.percentageComplete }}%</span>
              </div>
            </div>
          </div>
          <div class="large-progress-container">
            <div class="large-progress-bar">
              <div
                class="large-progress-fill"
                [style.width.%]="cuttingStats.totalProgress.percentageComplete">
                <span class="progress-text">{{ cuttingStats.totalProgress.percentageComplete }}%</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Procurement Tab -->
    <div class="tab-content" *ngIf="activeTab === 'procurement'">
      <div class="detail-grid">
        <!-- RFQ Time Stats - SIMPLIFIED -->
        <div class="time-stats-card">
          <div class="card-header">
            <h3 class="card-title">
              <i class="bi bi-clock-history"></i>
              ุฅุญุตุงุฆูุงุช ุทูุจุงุช ุงูุชุณุนูุฑ ุงูุฒูููุฉ
            </h3>
          </div>
          <div class="card-body">
            <div class="time-stats-grid">
              <div class="time-stat-box">
                <div class="time-icon">
                  <i class="bi bi-calendar-day-fill"></i>
                </div>
                <div class="time-content">
                  <span class="time-value">{{ formatNumber(rfqStats?.today || 0) }}</span>
                  <span class="time-label">ุงูููู</span>
                </div>
              </div>
              <div class="time-stat-box">
                <div class="time-icon">
                  <i class="bi bi-calendar-week-fill"></i>
                </div>
                <div class="time-content">
                  <span class="time-value">{{ formatNumber(rfqStats?.thisWeek || 0) }}</span>
                  <span class="time-label">ูุฐุง ุงูุฃุณุจูุน</span>
                </div>
              </div>
              <div class="time-stat-box">
                <div class="time-icon">
                  <i class="bi bi-calendar-month-fill"></i>
                </div>
                <div class="time-content">
                  <span class="time-value">{{ formatNumber(rfqStats?.thisMonth || 0) }}</span>
                  <span class="time-label">ูุฐุง ุงูุดูุฑ</span>
                </div>
              </div>
              <div class="time-stat-box highlight">
                <div class="time-icon">
                  <i class="bi bi-graph-up-arrow"></i>
                </div>
                <div class="time-content">
                  <span class="time-value">{{ formatNumber(rfqStats?.totalRFQs || 0) }}</span>
                  <span class="time-label">ุฅุฌูุงูู ุงูุทูุจุงุช</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Secretariat Tab - ONLY TYPE CHART -->
    <div class="tab-content" *ngIf="activeTab === 'secretariat'">
      <div class="charts-row single-chart">
        <div class="chart-card large">
          <div class="chart-header">
            <h3 class="chart-title">
              <i class="bi bi-pie-chart-fill"></i>
              ุชูุฒูุน ุงูููุงุฐุฌ ุญุณุจ ุงูููุน
            </h3>
          </div>
          <div class="chart-body large-chart">
            <canvas id="secretariatTypeChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- Suppliers Tab - REMOVED RATING SECTION -->
    <div class="tab-content" *ngIf="activeTab === 'suppliers'">
      <div class="charts-row">
        <!-- Status Distribution Chart -->
        <div class="chart-card">
          <div class="chart-header">
            <h3 class="chart-title">
              <i class="bi bi-pie-chart-fill"></i>
              ุชูุฒูุน ุงูููุฑุฏูู ุญุณุจ ุงูุญุงูุฉ
            </h3>
          </div>
          <div class="chart-body">
            <canvas id="supplierStatusChart"></canvas>
          </div>
        </div>

        <!-- Top Countries Stats -->
        <div class="chart-card">
          <div class="chart-header">
            <h3 class="chart-title">
              <i class="bi bi-geo-alt-fill"></i>
              ุฃุนูู 5 ุฏูู
            </h3>
          </div>
          <div class="chart-body">
            <div class="country-list">
              <div class="country-item" *ngFor="let label of suppliersByCountry.labels; let i = index">
                <div class="country-info">
                  <span class="country-flag">๐</span>
                  <span class="country-name">{{ label }}</span>
                </div>
                <div class="country-stats">
                  <span class="country-count">{{ suppliersByCountry.data[i] }}</span>
                  <div class="country-bar-mini">
                    <div
                      class="country-bar-fill"
                      [style.width.%]="getChartPercentage(suppliersByCountry.data, i)"
                      [style.background-color]="suppliersByCountry.colors[i]">
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>
